# CIM Analog Interface Specification

**文档用途**：供数字部分与模拟部分进行片外/片上数模混合集成接口商讨
**版本**：v2.1
**日期**：2026-02-27
**时钟频率目标**：50MHz（周期 20ns）
**参数口径**：本文涉及的默认时序参数以 `rtl/top/snn_soc_pkg.sv` 为准，若与文档不一致以 pkg 为准。

---

## 1. 概述

### 1.1 集成背景

本项目为数模混合 SNN SoC，数字部分负责：
- SoC 控制逻辑（总线、DMA、寄存器）
- SNN 控制器（时序协调）
- LIF 神经元（数字累加和阈值比较）

模拟部分负责：
- CIM Macro（模拟计算核心）
- DAC（数字到模拟转换）
- ADC（模拟到数字转换）

### 1.2 接口边界

```
┌─────────────────────────────────────────────────────────────┐
│                      数字部分                                │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐              │
│  │ DAC Ctrl │    │ CIM Ctrl │    │ ADC Ctrl │              │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘              │
│       │               │               │                     │
└───────┼───────────────┼───────────────┼─────────────────────┘
        │               │               │
════════╪═══════════════╪═══════════════╪══════════════════════  ← 数模接口边界
        │               │               │
┌───────┼───────────────┼───────────────┼─────────────────────┐
│       ▼               ▼               ▼                     │
│  ┌─────────────────────────────────────────┐               │
│  │           CIM Macro (Analog)            │               │
│  │  ┌─────┐   ┌─────────┐   ┌─────┐       │               │
│  │  │ DAC │ → │ CIM阵列 │ → │ ADC │       │               │
│  │  └─────┘   └─────────┘   └─────┘       │               │
│  └─────────────────────────────────────────┘               │
│                      模拟部分                                │
└─────────────────────────────────────────────────────────────┘
```

---

### 1.3 V1 冻结口径（必须遵守）

为避免后续接口漂移，V1 统一采用“内部并行 + 外部复用”双层口径：

- 内部并行口径（当前 `snn_soc_top` / `cim_macro_blackbox`）：
  `wl_spike[63:0] + dac_valid + cim_start/done + bl_sel[4:0] + adc_start/done + bl_data[7:0]`
- 外部复用口径（45-pin 方案，供 chip_top/pad 使用）：
  `wl_data[7:0] + wl_group_sel[2:0] + wl_latch + cim_start/done + bl_sel[4:0] + bl_data[7:0] + clk + rst_n`

当前 RTL 已加入协议原型：`rtl/snn/wl_mux_wrapper.sv`。

#### 1.3.1 WL 复用协议字段与拍数（冻结版）

| 字段 | 方向 | 位宽 | 说明 |
|:---|:---:|---:|:---|
| `wl_data` | D→A | 8 | 当前组（8 条 WL）的数据 |
| `wl_group_sel` | D→A | 3 | 组号，范围 0~7 |
| `wl_latch` | D→A | 1 | 组合输出，ST_SEND 全程（8 拍）保持高电平，与 `wl_data`/`wl_group_sel` 同拍有效，模拟侧在 `wl_latch=1` 期间每拍采样对应组数据 |
| `wl_ready` | A→D | 0 | **V1 不使用该信号**（无 ready，固定时序） |

固定时序（每个 bit-plane）：

1. 进入复用发送后，总计 10 拍：`1(锁存/进入发送) + 8(组 0→7) + 1(完成)`。  
2. 发送阶段每拍 `wl_latch=1`，`wl_data` 与 `wl_group_sel` 同拍有效。  
3. 复用发送完成后，进入内部固定时序 DAC 阶段（`dac_valid` 单拍仅用于行为模型锁存触发）与后续 `cim_start` 流程。  

#### 1.3.2 责任归属（明确条款）

- 数字侧负责：
  `wl_mux_wrapper` 发送顺序、组号编码、锁存脉冲时序；`bl_sel` 扫描与 Scheme B 数字差分减法。
- 模拟侧负责：
  接收 `wl_data[7:0]/wl_group_sel[2:0]/wl_latch` 并在芯片内部完成 WL de-mux（8 组 × 8bit 锁存器，共 64 根字线驱动）；CIM/ADC 模拟实现与 `cim_done/adc_done/bl_data` 返回时序。
  具体 de-mux 架构：模拟芯片内部有 8 个 8-bit 锁存器组，`wl_latch=1` 期间按 `wl_group_sel` 将 `wl_data` 写入对应锁存器；8 组全部写入后还原完整 64-bit WL 驱动向量。
- 后端/集成负责：
  在 `chip_top/pad wrapper` 完成 pad 复用映射与约束收敛，不改动已冻结字段定义。

---

## 2. 接口信号定义

### 2.1 信号总表

> 说明：本节表格为**内部并行接口口径**（`snn_soc_top` 与 `cim_macro_blackbox` 之间）。  
> 外部 45-pin 复用口径以 1.3 节为准。

| 信号名 | 方向 | 位宽 | 类型 | 说明 |
|:---|:---:|---:|:---:|:---|
| **时钟和复位** |||||
| `clk` | D→A | 1 | 时钟 | 系统时钟，50MHz |
| `rst_n` | D→A | 1 | 复位 | 异步复位，低有效 |
| **DAC 接口** |||||
| `wl_spike` | D→A | 64 | 数据 | 字线输入，64路并行 bit-plane |
| `dac_valid` | D→A | 1 | 脉冲 | DAC 数据有效，单拍脉冲（行为模型锁存触发）；真实芯片侧由 `wl_latch` 时序控制 |
| ~~`dac_ready`~~ | ~~A→D~~ | ~~1~~ | ~~握手~~ | **已移除（2026-02-27）**：模拟侧采用固定时序 de-mux，无需握手回路 |
| **CIM 计算接口** |||||
| `cim_start` | D→A | 1 | 脉冲 | CIM 计算启动，单拍脉冲 |
| `cim_done` | A→D | 1 | 脉冲 | CIM 计算完成，单拍脉冲 |
| **ADC 接口** |||||
| `bl_sel` | D→A | 5 | 控制 | 位线选择，0-19 有效（Scheme B：10 正 + 10 负） |
| `adc_start` | D→A | 1 | 脉冲 | ADC 采样启动，单拍脉冲 |
| `adc_done` | A→D | 1 | 脉冲 | ADC 采样完成，单拍脉冲 |
| `bl_data` | A→D | 8 | 数据 | 当前通道 ADC 输出，8-bit |

**注**：D→A = 数字到模拟，A→D = 模拟到数字

## ADC 和 DAC 的位宽

|模块|位宽|数量|说明|
|---|---|---|---|
|**DAC**|**1-bit**|**64 路**|每个字线是单bit数字信号 (0/1)|
|**ADC**|**8-bit**|**1 路**|时分复用20个通道（Scheme B），每次输出8-bit|

### 详细说明

#### 1. DAC 部分（数字 → 模拟）

```systemverilog
input logic [63:0] wl_spike;  // 64个1-bit数字信号
```

- **每个 wl_spike[i] 是 1-bit 数字信号**（0 或 1）
- 模拟宏内部的 DAC 将这 64 个 1-bit 数字信号转换成模拟电压/电流
- 用于驱动 64 根字线（Word Line）

**架构图**：

```
数字侧                           模拟侧
wl_spike[0] (1-bit) ──► 1-bit DAC ──► WL0 电压
wl_spike[1] (1-bit) ──► 1-bit DAC ──► WL1 电压
...
wl_spike[63] (1-bit) ──► 1-bit DAC ──► WL63 电压
```

#### 2. ADC 部分（模拟 → 数字）

```systemverilog
input  logic [4:0] bl_sel;    // 选择通道 0-19（Scheme B）
output logic [7:0] bl_data;   // 8-bit 输出
```

- **1 个 8-bit ADC**，时分复用采样 20 个位线通道（Scheme B）
- 通过 `bl_sel` 选择当前采样哪个通道（0-19，Scheme B）
- 输出 `bl_data[7:0]` 是 8-bit 数字值

**时分复用流程**：

```
模拟侧                              数字侧
BL0  电流 ─┐
BL1  电流 ─┤
...       ├─► 20:1 MUX ──► 8-bit ADC ──► bl_data[7:0]
BL19 电流 ─┘      ▲
                 │
            bl_sel[4:0]
```

---

## 总结

|参数|值|
|---|---|
|DAC 精度|1-bit（数字驱动）|
|DAC 通道数|64 路（并行）|
|ADC 精度|8-bit|
|ADC 通道数|20 路（时分复用，Scheme B：10 正 + 10 负）|

**为什么这样设计？**

- DAC 只需要 1-bit：因为是 SNN（脉冲神经网络），输入就是 0/1 的 spike
- ADC 使用 8-bit：设备测量确认 8-bit 精度已足够（建模定版 90.42% 测试精度，spike-only，zero-spike=0%）
### 2.2 信号详细说明

#### 2.2.1 wl_spike[63:0]

**功能**：输入字线驱动信号

**数据格式**：
- 表示同一子时间步的 64 维特征的某一 bit
- `wl_spike[i] = 1` 表示第 i 维特征在当前 bit-plane 为 1
- 共 8 个 bit-plane（对应 8-bit 特征值）
- 处理顺序：MSB-first（bit7 → bit0）

**时序要求**：
- 在 `dac_valid` 单拍到来时，`wl_spike` 必须稳定
- 行为模型在 `dac_valid` 单拍锁存 `wl_spike`；真实芯片侧由 `wl_latch` 时序控制

```
           ┌───────────────────┐
wl_spike   │    稳定数据        │
           └───────────────────┘
                   ↑
dac_valid  ────────┼────────────  (单拍脉冲)
                   │
                锁存点（行为模型）
```

#### 2.2.2 dac_valid（单拍触发）

**功能**：触发行为模型锁存 `wl_spike`；不是 backpressure 握手

**时序**：
```
clk        ─┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──
            └──┘  └──┘  └──┘  └──┘  └──┘  └──┘

wl_spike   ══════╱ 有效数据  ╲══════════════════
                 │          │
dac_valid  ──────┼──▓───────┼─────────────────
                 │          │
                 └── 行为模型锁存触发点
```

**约束**：
- `dac_valid` 必须是 1 个 cycle 脉冲
- `dac_valid` 脉冲到来时 `wl_spike` 需已稳定
- 数字控制链路按固定 `DAC_LATENCY_CYCLES` 等待后再发 `cim_start`

#### 2.2.3 cim_start / cim_done

**功能**：CIM 计算控制

**时序**：
```
clk        ─┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──
            └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘

cim_start  ──────┐  ┌─────────────────────────────────────
                 └──┘  (单拍脉冲)

           ←─────── CIM 计算时间 (CIM_LATENCY) ────────→

cim_done   ──────────────────────────────────────┐  ┌─────
                                                  └──┘
```

**参数**：
- `CIM_LATENCY_CYCLES`：CIM 计算延迟周期数
- 当前仿真默认值：10 cycles
- **模拟部分需要提供实际延迟范围**

#### 2.2.4 bl_sel[4:0]

**功能**：ADC 通道选择（时分复用 MUX 控制）

**有效范围**：0-19（Scheme B：0-9 正列，10-19 负列，共 20 通道）

**时序要求**：
- 切换后需等待 MUX 建立时间（`ADC_MUX_SETTLE_CYCLES`）
- 当前仿真默认值：2 cycles
- **模拟部分需要提供实际 MUX 建立时间**

#### 2.2.5 adc_start / adc_done / bl_data

**功能**：ADC 采样控制和数据输出

**时序**：
```
clk        ─┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──
            └──┘  └──┘  └──┘  └──┘  └──┘  └──┘

bl_sel     ══════╱  N  ╲════════════════════════
                 │     │
settle     ──────┼─────┼─── MUX 建立时间 ────────
                 │     │
adc_start  ──────┼─────┼───┐  ┌─────────────────
                 │     │   └──┘
                 │     │
           ←─────┼─────┼── ADC 采样时间 ────────→
                 │     │
adc_done   ──────┼─────┼──────────────────┐  ┌──
                 │     │                   └──┘
                 │     │                     │
bl_data    ══════╱═════╲═════════════════════╲ 有效数据
                                               │
                                           数据有效点
```

**参数**：
- `ADC_SAMPLE_CYCLES`：ADC 采样延迟周期数
- 当前仿真默认值：3 cycles
- **模拟部分需要提供实际采样时间**

**数据有效性**：
- `bl_data` 在 `adc_done` 拉高时有效
- 数据在下一个 `adc_start` 之前保持稳定

---

## 3. 时序参数汇总

### 3.1 数字侧提供的时序

| 参数 | 当前仿真值 | 单位 | 说明 |
|:---|---:|:---:|:---|
| 时钟周期 | 20 | ns | 50MHz |
| `dac_valid` 脉冲宽度 | 1 | cycle | 单拍脉冲（行为模型锁存触发，真实芯片侧使用 `wl_latch`） |
| `cim_start` 脉宽 | 1 | cycle | 单拍 |
| `adc_start` 脉宽 | 1 | cycle | 单拍 |
| `bl_sel` 提前量 | 1 | cycle | 在 adc_start 之前稳定 |

### 3.2 需要模拟侧确认的时序

| 参数 | 仿真默认值 | 需要确认 | 说明 |
|:---|---:|:---:|:---|
| WL 复用发送时间 | 10 cycles | 固定 | 1(锁存) + 8(发送组 0~7) + 1(完成) = 10 cycles |
| DAC 建立时间 | 5 cycles | ✓ | `dac_valid` 脉冲后 WL 电压建立时间（`dac_ready` 握手已移除，改为固定延迟） |
| CIM 计算时间 | 10 cycles | ✓ | `cim_done` 延迟 |
| MUX 建立时间 | 2 cycles | ✓ | `bl_sel` 切换后稳定时间 |
| ADC 采样时间 | 3 cycles | ✓ | `adc_done` 延迟 |
| ADC 数据保持时间 | ≥1 cycle | ✓ | `bl_data` 有效持续时间 |

---

## 4. 完整时序流程

### 4.1 单次推理子时间步流程

```
┌────────────────────────────────────────────────────────────────────┐
│                         一个子时间步                                │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌───────────────────┐  │
│  │ WL复用  │ → │  DAC    │ → │  CIM    │ → │      ADC (×20)      │  │
│  │ 8拍发送 │   │  阶段   │   │  阶段   │   │ bl_sel=0..19 轮询  │  │
│  └─────────┘   └─────────┘   └─────────┘   └───────────────────┘  │
│                                                                    │
│   ~10 cycles     ~5 cycles      ~10 cycles    ~(2+3)×20 = ~100    │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
                         总计约 125 cycles/子时间步
```

### 4.2 波形示例

```
clk        ─┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐
            └┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘

           ╔═══════════════════════════════════════════════════╗
           ║              一个完整子时间步流程                  ║
           ╚═══════════════════════════════════════════════════╝

           │◀── DAC ──▶│◀──── CIM ────▶│◀────── ADC ×20 ──────▶│

wl_spike   ════════╱ DATA ╲════════════════════════════════════════

dac_valid  ──────────────▓───────────────────────────────────────── (单拍脉冲)

// dac_ready: 已移除，固定时序，无需握手

cim_start  ────────────────▓───────────────────────────────────────

cim_done   ─────────────────────────────▓──────────────────────────

bl_sel     ══════════════════════════╱ 0 ╲╱ 1 ╲╱ 2 ╲... ╱19╲═══

adc_start  ─────────────────────────────▓───▓───▓─────────▓────────

adc_done   ────────────────────────────────▓───▓───▓─────────▓─────

bl_data    ═══════════════════════════════╱D0╲╱D1╲╱D2╲..╱D19╲═══
```

---

## 5. 电气特性

### 5.1 数字侧驱动能力

| 信号 | 驱动强度 | 负载要求 |
|:---|:---|:---|
| `wl_spike[63:0]` | 标准 CMOS | 待确认 |
| `dac_valid` | 标准 CMOS | 待确认 |
| `cim_start` | 标准 CMOS | 待确认 |
| `bl_sel[4:0]` | 标准 CMOS | 待确认 |
| `adc_start` | 标准 CMOS | 待确认 |

### 5.2 模拟侧输出要求

| 信号 | 电平标准 | 驱动能力 |
|:---|:---|:---|
| ~~`dac_ready`~~ | **已移除** | **已移除** |
| `cim_done` | 待确认 | 待确认 |
| `adc_done` | 待确认 | 待确认 |
| `bl_data[7:0]` | 待确认 | 待确认 |

**请模拟侧提供**：
- 输入信号的电压范围和阈值
- 输出信号的电压范围和驱动能力
- 是否需要电平转换

---

## 6. 设计约束

### 6.1 时钟约束

```tcl
# 目标时钟频率
create_clock -name clk -period 20.0 [get_ports clk]

# 时钟不确定度（留给模拟部分）
set_clock_uncertainty 1.0 [get_clocks clk]
```

### 6.2 接口时序约束

```tcl
# 输出到模拟部分（数字→模拟）
set_output_delay 3.0 -clock clk [get_ports {wl_spike* dac_valid cim_start bl_sel* adc_start}]

# 输入从模拟部分（模拟→数字）；dac_ready 已移除，无需约束
set_input_delay 3.0 -clock clk [get_ports {cim_done adc_done bl_data*}]
```

**注**：以上约束为初始估计，需要根据模拟部分实际时序调整。

---

## 7. 验证要求

### 7.1 功能验证

| 测试项      | 描述                                             | 负责方   |
| :------- | :--------------------------------------------- | :---- |
| DAC 触发时序 | `dac_valid` 单拍 + 固定 `DAC_LATENCY_CYCLES` 延迟正确性 | 数字+模拟 |
| CIM 计算   | start→done 延迟符合预期                              | 模拟    |
| ADC 时分复用 | 20 通道轮询正确性（Scheme B）                           | 数字+模拟 |
| 数据完整性    | bl_data 数值正确                                   | 模拟    |
| 端到端      | 完整推理流程                                         | 数字+模拟 |
|          |                                                |       |

### 7.2 时序验证

| 测试项 | 描述 | 验收标准 |
|:---|:---|:---|
| Setup/Hold | 接口信号时序 | 无违例 |
| 时钟频率 | 50MHz 运行 | 无违例 |
| 复位 | 异步复位正确性 | 功能正确 |

---

## 8. 行为模型说明

### 8.1 当前行为模型位置

```
rtl/snn/cim_macro_blackbox.sv
rtl/snn/wl_mux_wrapper.sv   // WL 复用协议原型（冻结字段/时序）
```

### 8.2 行为模型输出规则

当前仿真用的简化输出规则：

```systemverilog
// 在 adc_done 时更新（Scheme B：20 通道，前 10 正列 + 后 10 负列）
pop = popcount(wl_latched);  // 0-64
for (int j = 0; j < ADC_CHANNELS; j++) begin  // ADC_CHANNELS=20
    if (j < NUM_OUTPUTS) begin
        bl_data_internal[j] <= (pop * 2 + j) & 8'hFF;           // 正列
    end else begin
        bl_data_internal[j] <= ((pop >> 1) + (j - NUM_OUTPUTS)) & 8'hFF;  // 负列
    end
end

// bl_data 由 MUX 选择
bl_data = bl_data_internal[bl_sel];
```

**说明**：
- `popcount` 统计锁存后的 `wl_latched` 中 1 的个数（0-64）
- Scheme B 差分结构：正列产生较高值，负列产生较低值
- 数字侧在 ADC 控制器中执行差分减法：`diff[i] = raw[i] - raw[i+10]`（i=0..9）
- 真实 CIM 会输出实际的 MAC 结果

### 8.3 集成时的替换方式

```systemverilog
// 综合时使用黑盒
`ifdef SYNTHESIS
module cim_macro_blackbox (...);
    // 仅端口定义，无实现
endmodule
`else
// 仿真时使用行为模型
module cim_macro_blackbox (...);
    // 行为模型实现
endmodule
`endif
```

集成真实 CIM Macro 时：
1. 保持端口定义不变
2. 替换为真实模拟模块
3. 或使用混合仿真（AMS）

---

## 9. 待确认事项清单

### 9.1 时序参数

| 序号 | 参数 | 仿真默认值 | 模拟侧确认值 | 状态 |
|:---:|:---|---:|---:|:---:|
| 1 | DAC 建立时间 | 5 cycles | | 待确认 |
| 2 | CIM 计算时间 | 10 cycles | | 待确认 |
| 3 | MUX 建立时间 | 2 cycles | | 待确认 |
| 4 | ADC 采样时间 | 3 cycles | | 待确认 |
| 5 | ADC 数据保持时间 | 1 cycle | | 待确认 |

### 9.2 电气参数

| 序号 | 参数 | 数字侧要求 | 模拟侧提供 | 状态 |
|:---:|:---|:---|:---|:---:|
| 1 | 输入高电平阈值 | | | 待确认 |
| 2 | 输入低电平阈值 | | | 待确认 |
| 3 | 输出高电平 | | | 待确认 |
| 4 | 输出低电平 | | | 待确认 |
| 5 | 是否需要电平转换 | | | 待确认 |

### 9.3 其他事项

| 序号 | 事项 | 状态 |
|:---:|:---|:---:|
| 1 | CIM Macro 的 LEF 文件 | 待提供 |
| 2 | CIM Macro 的 Liberty 文件 | 待提供 |
| 3 | CIM Macro 的 GDS 文件 | 待提供 |
| 4 | 混合仿真模型 | 待提供 |
| 5 | 接口时序约束文件 | 待协商 |


---

## 附录 A：Verilog 端口定义

```systemverilog
module cim_macro_blackbox #(
    parameter int P_NUM_INPUTS   = snn_soc_pkg::NUM_INPUTS,    // 64
    parameter int P_ADC_CHANNELS = snn_soc_pkg::ADC_CHANNELS,  // 20
    parameter int P_ADC_BITS     = snn_soc_pkg::ADC_BITS       // 8
) (
    // 时钟和复位
    input  logic        clk,
    input  logic        rst_n,

    // DAC 接口
    input  logic [P_NUM_INPUTS-1:0] wl_spike,  // 64-bit 字线输入
    // dac_valid: 单拍脉冲，通知行为模型锁存 wl_spike（真实芯片侧由 wl_latch 控制）
    // dac_ready 已移除（2026-02-27）：固定时序，无需握手
    input  logic        dac_valid,

    // CIM 计算接口
    input  logic        cim_start,              // 计算启动脉冲
    output logic        cim_done,               // 计算完成脉冲

    // ADC 接口
    input  logic [$clog2(P_ADC_CHANNELS)-1:0] bl_sel,  // 通道选择 0-19（Scheme B）
    input  logic        adc_start,              // ADC 采样启动
    output logic        adc_done,               // ADC 采样完成
    output logic [P_ADC_BITS-1:0] bl_data       // 8-bit ADC 输出
);
```

---

## 注：接口部分

**模拟部分需要提供：**

1. ✅ 符合接口定义的 CIM Macro（端口完全匹配）
2. ✅ 确认表格中的时序参数（DAC/CIM/ADC 延迟）
3. ✅ 提供 LEF/Liberty/GDS 文件用于后端集成（V3)

---

## 物理阵列大小

根据当前设计参数：

|维度|值|说明|
|---|---|---|
|**输入（字线 WL）**|**64**|8×8 离线投影后特征，对应 `wl_spike[63:0]`|
|**输出（位线 BL）**|**20**|Scheme B 差分：10 正列 + 10 负列，`bl_sel` 0-19|

所以有效使用的阵列是：

```
        ←──────── 20 个位线（输出，Scheme B 差分）───────→
        BL0+ BL1+ ... BL9+  BL0- BL1- ... BL9-
    ↑   ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │   │W[0]│    │    │    │    │    │    │    │
    │   ├────┼────┼────┼────┼────┼────┼────┼────┤
   64   │W[1]│    │    │    │    │    │    │    │
   个   ├────┼────┼────┼────┼────┼────┼────┼────┤
   字   │... │    │    │    │    │    │    │    │
   线   ├────┼────┼────┼────┼────┼────┼────┼────┤
  (输入)│W[63]│   │    │    │    │    │    │    │
    ↓   └────┴────┴────┴────┴────┴────┴────┴────┘
         WL0  WL1  WL2  ...                     WL63
```

**物理规模：128 × 256 RRAM 阵列（差分结构，有效 64 × 20 = 1280 个存储单元）**

---

## 需要确认的事项

重点确认：

```markdown
1. 阵列规模确认
   - 字线数量：64 根（输入维度，8×8 离线投影后特征）
   - 位线数量：20 根（Scheme B：10 正 + 10 负）
   - 物理阵列：128×256 RRAM（差分结构）

2. 时序参数（08文档第9节的表格）
   - DAC 建立时间：实际是多少？（仿真默认 5 cycles）
   - CIM 计算时间：实际是多少？（仿真默认 10 cycles）
   - ADC 采样时间：实际是多少？（仿真默认 3 cycles）
   - MUX 建立时间：实际是多少？（仿真默认 2 cycles）

3. 电气参数
   - 输入电平要求？
   - 输出驱动能力？
```

---

## 关于物理阵列与逻辑映射的澄清

物理阵列为 128×256 RRAM，采用差分结构（Scheme B）：

|层面|规模|说明|
|---|---|---|
|物理 RRAM|128 × 256|0T1R 阵列，差分结构|
|有效使用|64 × 20|64 WL（10 正列 + 10 负列）|
|逻辑输出|10 类别|数字侧差分后得到 10 个有符号结果|

**V1 输入说明**：芯片输入的是离线预处理后的 64 维特征向量（proj_sup_64: 784→64），不是原始像素。
